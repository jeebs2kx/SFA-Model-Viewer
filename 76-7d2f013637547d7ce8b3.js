"use strict";(self.webpackChunk_jstpierre_noclip_website=self.webpackChunk_jstpierre_noclip_website||[]).push([[76],{7076:(e,r,t)=>{t.d(r,{makeDebugTextDrawer:()=>W});var a=t(2019),s=t(9536),i=t(9953),c=t(4442),n=t(9374),h=t(4786),o=t(2617),d=t(4074),l=t(4674),w=t(5377),u=t(1780),f=t(3517),D=t(9411),m=t(3145);const p=s.Ue(),g=i.Ue(),C=new f.SH;class S{constructor(e,r){this.fontData=r,this.charWriter=new o._z,this.ddraw=new w.W,this.textColor=(0,h.nz)(h.Ej),this.strokeColor=(0,h.nz)(h.jS),this.renderCache=new m.y(e),this.charWriter.setFont(r,0,0);const t=this.ddraw;t.setVtxDesc(9,!0),t.setVtxDesc(11,!0),t.setVtxDesc(13,!0)}setSceneParams(e,r,t,a){let s=e.allocateUniformBuffer(u.Cl.ub_SceneParams,f.CD);const i=e.mapUniformBufferF32(u.Cl.ub_SceneParams);(0,n.hn)(C.u_Projection,0,r,0,t,-1e4,1e4),(0,D.D)(C.u_Projection,a,-1),(0,f.jJ)(i,s,C)}setDrawParams(e){let r=e.allocateUniformBuffer(u.Cl.ub_DrawParams,16);const t=e.mapUniformBufferF32(u.Cl.ub_DrawParams);s.yR(p),r+=(0,a.tw)(t,r,p)}beginDraw(){this.ddraw.beginDraw(this.renderCache)}endDraw(e){this.ddraw.endDraw(e)}setFontScale(e){this.charWriter.scale[0]=e,this.charWriter.scale[1]=e}getScaledLineHeight(){return this.charWriter.getScaledLineHeight()}reserveString(e,r=4){const t=(1+r)*e;this.ddraw.allocPrimitives(128,4*t)}drawString(e,r,t,a,s,i,n=1,o=4){const d=this.renderCache;c.bM(this.charWriter.origin),c.JG(this.charWriter.cursor,this.charWriter.origin),this.charWriter.calcRect(g,a);const l=g[0];s-=(g[2]-l)/2;const w=e.pushTemplateRenderInst();w.setBindingLayouts(f.sX);const u=d.device.queryVendorInfo().clipSpaceNearZ;this.setSceneParams(w,r,t,u),this.setDrawParams(w),(0,h.EY)(this.charWriter.color1,this.strokeColor);for(let r=0;r<o;r++){const t=6.283185307179586*r/o,h=n*Math.sin(t),l=n*Math.cos(t);c.t8(this.charWriter.cursor,s+l,i+h,0),this.charWriter.drawString(e,d,this.ddraw,a)}(0,h.EY)(this.charWriter.color1,this.textColor),c.t8(this.charWriter.cursor,s,i,0),this.charWriter.drawString(e,d,this.ddraw,a),e.popTemplateRenderInst()}destroy(e){this.fontData.destroy(e),this.ddraw.destroy(e),this.renderCache.destroy()}}async function W(e){return e.dataShare.ensureObject("DebugTextDrawer",(async()=>{const r=await e.dataFetcher.fetchData("SuperMarioGalaxy/LayoutData/Font.arc"),t=l.Q(await(0,d.L)(r)),a=(0,o.KG)(t.findFileData("messagefont26.brfnt")),s=new o.Cs(e.device,a);return new S(e.device,s)}))}}}]);